<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-advanced/native-aot">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Native AOT | Serverless .NET</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://serverlessdotnet.dev/docs/advanced/native-aot"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content=".NET, serverless, aws, aws lambda, dotnet"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Native AOT | Serverless .NET"><meta data-rh="true" name="description" content="Native ahead of time (AOT) compilation is a new feature that went live with the general availability of .NET 7. Native AOT produces an application that is pre-compiled to native code. This allows users of the app to run it on a machine without the .NET runtime being installed."><meta data-rh="true" property="og:description" content="Native ahead of time (AOT) compilation is a new feature that went live with the general availability of .NET 7. Native AOT produces an application that is pre-compiled to native code. This allows users of the app to run it on a machine without the .NET runtime being installed."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://serverlessdotnet.dev/docs/advanced/native-aot"><link data-rh="true" rel="alternate" href="https://serverlessdotnet.dev/docs/advanced/native-aot" hreflang="en"><link data-rh="true" rel="alternate" href="https://serverlessdotnet.dev/docs/advanced/native-aot" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ELBLZN8LN3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ELBLZN8LN3",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.e00d95ac.css">
<link rel="preload" href="/assets/js/runtime~main.983b73cc.js" as="script">
<link rel="preload" href="/assets/js/main.761a135f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Serverless .NET</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jeastham1993/serverless-dotnet.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/fundamentals">Fundamentals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Fundamentals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/your-first-lambda">Your First Lambda</a><button aria-label="Toggle the collapsible sidebar category &#x27;Your First Lambda&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/aspnet-on-lambda">ASP.NET on Lambda</a><button aria-label="Toggle the collapsible sidebar category &#x27;ASP.NET on Lambda&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/event-sources">Event Sources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Event Sources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/developer-tooling">Developer Tooling</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Tooling&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/testing">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/ide-support">IDE Support</a><button aria-label="Toggle the collapsible sidebar category &#x27;IDE Support&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/observability">Observability</a><button aria-label="Toggle the collapsible sidebar category &#x27;Observability&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/build-patterns">Build Patterns</a><button aria-label="Toggle the collapsible sidebar category &#x27;Build Patterns&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/advanced-concepts">Advanced Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/advanced/native-aot">Native AOT</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/advanced-concepts"><span itemprop="name">Advanced Concepts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Native AOT</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Native AOT</h1></header><p><a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/" target="_blank" rel="noopener noreferrer">Native ahead of time (AOT)</a> compilation is a new feature that went live with the general availability of .NET 7. Native AOT produces an application that is pre-compiled to native code. This allows users of the app to run it on a machine without the .NET runtime being installed.</p>
<p>One of the benefits of native AOT is the start-up speed. As the application is pre-compiled to native code there is no need for just-in-time (JIT) compilati0on, instead the app is ready to run immediately. This is beneficial in environments with lots of deployed instances, like AWS Lambda. Native AOT applications target a specific runtime and must be compiled on the OS and processor architecture that they will run on in production.</p>
<blockquote>
<p>Due to the underlying OS of AWS Lambda, native AOT will only run on the x84 architecture.</p>
</blockquote>
<p>There are some limitations to native AOT, the biggest being the lack of support for run-time code generation. This has an impact on any systems that use unconstrained reflection. Both System.Text.Json and Newtonsoft.Json rely heavily on reflection to function, meaning any JSON (de)serialiazation using either of these libraryies will require changes.</p>
<p>Let&#x27;s dive into how you can run native AOT applications on AWS Lambda.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-tooling">AWS Tooling<a class="hash-link" href="#aws-tooling" title="Direct link to heading">​</a></h2>
<p>AWS announched tooling to support to make it easier to build and deploy native AOT applications to Lambda. This tooling makes use of <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a>, ensure you have Docker running on your system. Also ensure you have version 5.6.0 or later of the <a href="https://www.nuget.org/packages/Amazon.Lambda.Tools" target="_blank" rel="noopener noreferrer">Amazon.Lambda.Tools</a>.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="install-tools" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>install-tools</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>dotnet tool install --global Amazon.Lambda.Tools</span></div></div><br></code></div></div></div></div>
<p>AWS also announched pre-built templates to quickly get started with native AOT. Ensure you have the latest version of the <a href="https://www.nuget.org/packages/Amazon.Lambda.Templates" target="_blank" rel="noopener noreferrer">Amazon.Lambda.Templates</a>.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="install-tools" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>install-tools</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>dotnet new --install Amazon.Lambda.Templates</span></div></div><br></code></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">​</a></h2>
<p>To get started with your first native AOT Lambda function run the following command to start a new project:</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="new-native-aot" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>new-native-aot</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>dotnet new lambda.NativeAOT -n LambdaNativeAot</span></div></div><br></code></div></div></div></div>
<p>Open up the project in the IDE of your choice and let&#x27;s have a look at the code.</p>
<style class="ssmq-0">.ssmq-0.ssmq-default{display:block}.ssmq-0:not(.ssmq-default){display: none;}
@media not screen, (max-width: 768px){.ssmq-0.ssmq-notscreenmax-width768px{display:block}.ssmq-0:not(.ssmq-notscreenmax-width768px){display: none;}}</style><div class="ssmq-0 ssmq-notscreenmax-width768px"><section class="ch-scrollycoding-static"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="function-code">Function Code<a class="hash-link" href="#function-code" title="Direct link to heading">​</a></h2><p>Native AOT compiles application code down to a single binary. This means the application entry-point needs to be a <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">static</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">Main</span><span style="color:#ECEFF4">()</span></code></span> method. The main method uses the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">LambdaBootstrapBuilder</span></code></span> class that comes from the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">Amazon.Lambda.RuntimeSupport</span></code></span> Nuget package. The <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">Create</span></code></span> method bootstraps the Lambda runtime, passing in the actual FunctionHandler method as well as a serializer to use. The <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">RunAsync</span><span style="color:#ECEFF4">()</span></code></span> method makes the function ready to receive requests.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="Function.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>Function.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.Core;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.RuntimeSupport;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.Serialization.SystemTextJson;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using System.Text.Json.Serialization;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>namespace LambdaNativeAot;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public class Function</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    private static async Task Main()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Func&lt;string, ILambdaContext, string&gt; handler = FunctionHandler;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        await LambdaBootstrapBuilder.Create(handler, new SourceGeneratorLambdaJsonSerializer&lt;LambdaFunctionJsonSerializerContext&gt;())</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            .Build()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            .RunAsync();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    public static string FunctionHandler(string input, ILambdaContext context)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        return input.ToUpper();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>[JsonSerializable(typeof(string))]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public partial class LambdaFunctionJsonSerializerContext : JsonSerializerContext</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deserialization">(De)Serialization<a class="hash-link" href="#deserialization" title="Direct link to heading">​</a></h2><p>As mentioned earlier, native AOT removes the support for using common JSON (de)seraizliation libraries. In .NET 6, Microsoft introduced <a href="https://devblogs.microsoft.com/dotnet/try-the-new-system-text-json-source-generator/" target="_blank" rel="noopener noreferrer">source generated serializers</a>. Source generated serialization generates the code required for (de)serailization at compile time.</p><p>To use source generated serializers you need to specify a partial class that inherits from the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">JsonSerializerContext</span></code></span> class. Annotations are then added to that class to define which objects to generate compile time code for. In this instance, this is just a string. All objects you need to (de)seriailize need to be added as an annotation, including any Lambda event sources like <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">SQSEvent</span></code></span> or <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">APIGatewayHttpApiV2ProxyRequest</span></code></span>.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="Function.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>Function.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.Core;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.RuntimeSupport;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.Serialization.SystemTextJson;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using System.Text.Json.Serialization;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>namespace LambdaNativeAot;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public class Function</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    private static async Task Main()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Func&lt;string, ILambdaContext, string&gt; handler = FunctionHandler;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        await LambdaBootstrapBuilder.Create(handler, new SourceGeneratorLambdaJsonSerializer&lt;LambdaFunctionJsonSerializerContext&gt;())</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            .Build()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            .RunAsync();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    public static string FunctionHandler(string input, ILambdaContext context)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        return input.ToUpper();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>[JsonSerializable(typeof(string))]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public partial class LambdaFunctionJsonSerializerContext : JsonSerializerContext</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-file-updates">Project File Updates<a class="hash-link" href="#project-file-updates" title="Direct link to heading">​</a></h2><p>Updates are required to the csproj file to enable both native AOT and allow the code to run on AWS Lambda. The first is to set the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">TargetFramework</span></code></span> to <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">net7.0</span></code></span>.</p><p>Native AOT on Lambda makes use of <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" target="_blank" rel="noopener noreferrer">Lambda custom runtimes</a>. Custom runtimes allow you to bring your own runtime to Lambda. When using a custom runtime the Lambda service looks for a file named <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">bootstrap</span></code></span>. For that reason, the compiled assembly name needs to be output with the name bootstrap. The final change is to set the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">PublishAot</span></code></span> flag to true.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="Function.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>Function.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;PropertyGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TargetFramework&gt;net7.0&lt;/TargetFramework&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;AssemblyName&gt;bootstrap&lt;/AssemblyName&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PublishAot&gt;true&lt;/PublishAot&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;Nullable&gt;enable&lt;/Nullable&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;AWSProjectType&gt;Lambda&lt;/AWSProjectType&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;CopyLocalLockFileAssemblies&gt;true&lt;/CopyLocalLockFileAssemblies&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;StripSymbols&gt;true&lt;/StripSymbols&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/PropertyGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;ItemGroup Condition=&quot;&#x27;$(RuntimeIdentifier)&#x27; == &#x27;linux-arm64&#x27;&quot;&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;RuntimeHostConfigurationOption Include=&quot;System.Globalization.AppLocalIcu&quot; Value=&quot;68.2.0.9&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Microsoft.ICU.ICU4C.Runtime&quot; Version=&quot;68.2.0.9&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Amazon.Lambda.RuntimeSupport&quot; Version=&quot;1.8.2&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Amazon.Lambda.Core&quot; Version=&quot;2.1.0&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Amazon.Lambda.Serialization.SystemTextJson&quot; Version=&quot;2.3.0&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;RdXmlFile Include=&quot;rd.xml&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>&lt;/Project&gt;</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="trimming-options">Trimming Options<a class="hash-link" href="#trimming-options" title="Direct link to heading">​</a></h2><p>Native AOT compilation trims your application code, making the bundle size as small as possible. Many Nuget libraries are not yet &#x27;trim friendly&#x27;, meaning required pieces of code may be removed. Microsoft provide a way to exclude libraries from trimming using the <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/trimming/trimming-options?pivots=dotnet-7-0" target="_blank" rel="noopener noreferrer">trimming options</a> built into the compiler. To exclude an assembly from the trimming, specify it as a <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">&lt;TrimmerRootAssembly&gt;</span></code></span>.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="Function.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>Function.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;PropertyGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TargetFramework&gt;net7.0&lt;/TargetFramework&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;AssemblyName&gt;bootstrap&lt;/AssemblyName&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PublishAot&gt;true&lt;/PublishAot&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;Nullable&gt;enable&lt;/Nullable&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;AWSProjectType&gt;Lambda&lt;/AWSProjectType&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;CopyLocalLockFileAssemblies&gt;true&lt;/CopyLocalLockFileAssemblies&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;StripSymbols&gt;true&lt;/StripSymbols&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/PropertyGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;ItemGroup Condition=&quot;&#x27;$(RuntimeIdentifier)&#x27; == &#x27;linux-arm64&#x27;&quot;&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;RuntimeHostConfigurationOption Include=&quot;System.Globalization.AppLocalIcu&quot; Value=&quot;68.2.0.9&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Microsoft.ICU.ICU4C.Runtime&quot; Version=&quot;68.2.0.9&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Amazon.Lambda.RuntimeSupport&quot; Version=&quot;1.8.2&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Amazon.Lambda.Core&quot; Version=&quot;2.1.0&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;PackageReference Include=&quot;Amazon.Lambda.Serialization.SystemTextJson&quot; Version=&quot;2.3.0&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;AWSSDK.Core&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;AWSSDK.DynamoDBv2&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;AWSXRayRecorder.Core&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;AWSXRayRecorder.Handlers.AwsSdk&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;Shared&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;Amazon.Lambda.AspNetCoreServer.Hosting&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    &lt;TrimmerRootAssembly Include=&quot;Amazon.Lambda.AspNetCoreServer&quot; /&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>  &lt;/ItemGroup&gt;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>&lt;/Project&gt;</span></div></div><br></code></div></div></div></div></section></div><div class="ssmq-0 ssmq-default"><section class="ch-scrollycoding"><div class="ch-scrollycoding-content"><div class="ch-scrollycoding-step-content" data-selected="true"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="function-code">Function Code<a class="hash-link" href="#function-code" title="Direct link to heading">​</a></h2><p>Native AOT compiles application code down to a single binary. This means the application entry-point needs to be a <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">static</span><span style="color:#D8DEE9FF"> </span><span style="color:#88C0D0">Main</span><span style="color:#ECEFF4">()</span></code></span> method. The main method uses the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">LambdaBootstrapBuilder</span></code></span> class that comes from the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">Amazon.Lambda.RuntimeSupport</span></code></span> Nuget package. The <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">Create</span></code></span> method bootstraps the Lambda runtime, passing in the actual FunctionHandler method as well as a serializer to use. The <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#ECEFF4">.</span><span style="color:#88C0D0">RunAsync</span><span style="color:#ECEFF4">()</span></code></span> method makes the function ready to receive requests.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deserialization">(De)Serialization<a class="hash-link" href="#deserialization" title="Direct link to heading">​</a></h2><p>As mentioned earlier, native AOT removes the support for using common JSON (de)seraizliation libraries. In .NET 6, Microsoft introduced <a href="https://devblogs.microsoft.com/dotnet/try-the-new-system-text-json-source-generator/" target="_blank" rel="noopener noreferrer">source generated serializers</a>. Source generated serialization generates the code required for (de)serailization at compile time.</p><p>To use source generated serializers you need to specify a partial class that inherits from the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">JsonSerializerContext</span></code></span> class. Annotations are then added to that class to define which objects to generate compile time code for. In this instance, this is just a string. All objects you need to (de)seriailize need to be added as an annotation, including any Lambda event sources like <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">SQSEvent</span></code></span> or <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">APIGatewayHttpApiV2ProxyRequest</span></code></span>.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-file-updates">Project File Updates<a class="hash-link" href="#project-file-updates" title="Direct link to heading">​</a></h2><p>Updates are required to the csproj file to enable both native AOT and allow the code to run on AWS Lambda. The first is to set the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">TargetFramework</span></code></span> to <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">net7.0</span></code></span>.</p><p>Native AOT on Lambda makes use of <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" target="_blank" rel="noopener noreferrer">Lambda custom runtimes</a>. Custom runtimes allow you to bring your own runtime to Lambda. When using a custom runtime the Lambda service looks for a file named <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">bootstrap</span></code></span>. For that reason, the compiled assembly name needs to be output with the name bootstrap. The final change is to set the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">PublishAot</span></code></span> flag to true.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="trimming-options">Trimming Options<a class="hash-link" href="#trimming-options" title="Direct link to heading">​</a></h2><p>Native AOT compilation trims your application code, making the bundle size as small as possible. Many Nuget libraries are not yet &#x27;trim friendly&#x27;, meaning required pieces of code may be removed. Microsoft provide a way to exclude libraries from trimming using the <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/trimming/trimming-options?pivots=dotnet-7-0" target="_blank" rel="noopener noreferrer">trimming options</a> built into the compiler. To exclude an assembly from the trimming, specify it as a <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">&lt;TrimmerRootAssembly&gt;</span></code></span>.</p></div></div><div class="ch-scrollycoding-sticker"><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="Function.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>Function.cs</div></div><div style="flex:1;min-width:0.8em"></div><svg class="ch-editor-button" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="button"><title>Expand</title><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg><dialog class="ch-expand-dialog"><svg class="ch-expand-close" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="button"><title>Close</title><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></dialog></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.Core;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.RuntimeSupport;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using Amazon.Lambda.Serialization.SystemTextJson;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>using System.Text.Json.Serialization;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>namespace LambdaNativeAot;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public class Function</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    private static async Task Main()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Func&lt;string, ILambdaContext, string&gt; handler = FunctionHandler;</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        await LambdaBootstrapBuilder.Create(handler, new SourceGeneratorLambdaJsonSerializer&lt;LambdaFunctionJsonSerializerContext&gt;())</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            .Build()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            .RunAsync();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    public static string FunctionHandler(string input, ILambdaContext context)</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        return input.ToUpper();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    }</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>[JsonSerializable(typeof(string))]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public partial class LambdaFunctionJsonSerializerContext : JsonSerializerContext</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div></div></section></div><script class="ssmq-0">!function(){for(var e=["not screen, (max-width: 768px)","default"],t=["ssmq-notscreenmax-width768px","ssmq-default"],s=document.getElementsByTagName("script"),o=s[s.length-1].parentNode,r=null,c=0;c<e.length-1;c++)if(window.matchMedia(e[c]).matches){r=o.querySelector(":scope > .ssmq-0."+t[c]);break}if(!r){var a=t.pop();r=o.querySelector(":scope > .ssmq-0."+a)}r.removeAttribute("class"),o.querySelectorAll(":scope > .ssmq-0").forEach((function(e){o.removeChild(e)}))}()</script>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying">Deploying<a class="hash-link" href="#deploying" title="Direct link to heading">​</a></h2>
<p>When ready to deploy, it&#x27;s as simple as using the <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">deploy</span><span style="color:#81A1C1">-function</span></code></span> command in the CLI global tooling. This command downloads a Docker image built using Amazon Linux 2 (AL2) as a base image. Your local file system is then attached to a running container, your code is compiled within this container. If the deploy-function comamnd is executed on a machine running AL2 then the publish will run as normal.</p>
<div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="deploy.sh" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>deploy.sh</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>dotnet lambda deploy-function</span></div></div><br></code></div></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/advanced/native-aot.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/advanced-concepts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Advanced Concepts</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#aws-tooling" class="table-of-contents__link toc-highlight">AWS Tooling</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a></li><li><a href="#function-code" class="table-of-contents__link toc-highlight">Function Code</a></li><li><a href="#deserialization" class="table-of-contents__link toc-highlight">(De)Serialization</a></li><li><a href="#project-file-updates" class="table-of-contents__link toc-highlight">Project File Updates</a></li><li><a href="#trimming-options" class="table-of-contents__link toc-highlight">Trimming Options</a></li><li><a href="#deploying" class="table-of-contents__link toc-highlight">Deploying</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Built by @plantpowerjames</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/plantpowerjames" target="_blank" rel="noopener noreferrer" class="footer__link-item">@plantpowerjames</a></li><li class="footer__item"><a href="https://github.com/jeastham1993/serverless-dotnet.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report Issues on GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Serverless .NET. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.983b73cc.js"></script>
<script src="/assets/js/main.761a135f.js"></script>
</body>
</html>