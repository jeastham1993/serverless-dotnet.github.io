<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-testing/unit-testing">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Unit Test Your Business Logic | Serverless .NET</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://serverlessdotnet.dev/docs/testing/unit-testing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content=".NET, serverless, aws, aws lambda, dotnet"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Unit Test Your Business Logic | Serverless .NET"><meta data-rh="true" name="description" content="Let&#x27;s kick this section off with a quote from Martin Fowler around unit testing:"><meta data-rh="true" property="og:description" content="Let&#x27;s kick this section off with a quote from Martin Fowler around unit testing:"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://serverlessdotnet.dev/docs/testing/unit-testing"><link data-rh="true" rel="alternate" href="https://serverlessdotnet.dev/docs/testing/unit-testing" hreflang="en"><link data-rh="true" rel="alternate" href="https://serverlessdotnet.dev/docs/testing/unit-testing" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ELBLZN8LN3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ELBLZN8LN3",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.e00d95ac.css">
<link rel="preload" href="/assets/js/runtime~main.983b73cc.js" as="script">
<link rel="preload" href="/assets/js/main.761a135f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Serverless .NET</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jeastham1993/serverless-dotnet.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/fundamentals">Fundamentals</a><button aria-label="Toggle the collapsible sidebar category &#x27;Fundamentals&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/your-first-lambda">Your First Lambda</a><button aria-label="Toggle the collapsible sidebar category &#x27;Your First Lambda&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/aspnet-on-lambda">ASP.NET on Lambda</a><button aria-label="Toggle the collapsible sidebar category &#x27;ASP.NET on Lambda&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/event-sources">Event Sources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Event Sources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/developer-tooling">Developer Tooling</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Tooling&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/testing">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/serverless-testing-introduction">An Introduction to Serverless Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/test-ready-lambda-functions">Test Ready Lambda Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/testing/unit-testing">Unit Test Your Business Logic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/testing/integration-testing">Integration Test In The Cloud</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/ide-support">IDE Support</a><button aria-label="Toggle the collapsible sidebar category &#x27;IDE Support&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/observability">Observability</a><button aria-label="Toggle the collapsible sidebar category &#x27;Observability&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/build-patterns">Build Patterns</a><button aria-label="Toggle the collapsible sidebar category &#x27;Build Patterns&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/advanced-concepts">Advanced Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/testing"><span itemprop="name">Testing</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Unit Test Your Business Logic</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unit Test Your Business Logic</h1></header><p>Let&#x27;s kick this section off with a quote from Martin Fowler around unit testing:</p>
<blockquote>
<p>Even a classic tester like myself uses test doubles when there&#x27;s an awkward collaboration. They are invaluable to <strong>remove non-determinism when talking to remote services</strong>. Indeed some classicist xunit testers also argue that any collaboration with external resources, such as a database or filesystem, should use doubles. Partly this is due to non-determinism risk, partly due to speed. While I think this is a useful guideline, I don&#x27;t treat using doubles for external resources as an absolute rule. <strong>If talking to the resource is stable and fast enough for you then there&#x27;s no reason not to do it in your unit tests</strong>.</p>
</blockquote>
<p><em>- Martin Fowler</em></p>
<p>There are two opposing views here, both of which are valid in the right scenario. The first, using mocks to remove non-determnism when talking to remove services, is one of the most important when writing unit tests against serverless applications. Unit tests could quite easily interact with the cloud services themselves, but there are a number of potential blockers here.</p>
<ul>
<li>Does your company allow each developer to have their own resources/AWS account?</li>
<li>Do you have permission to connect directly from your developer machine to AWS?</li>
<li>What if another engineer changes the resources you&#x27;ve perfectly aligned for your test run?</li>
</ul>
<p>There are a number of factors that can make your unit tests non-detminisitic, making them brittle.</p>
<p>Intead, <strong>focus on your business logic</strong> when developing locally. Let&#x27;s look at an example:</p>
<style class="ssmq-10">.ssmq-10.ssmq-default{display:block}.ssmq-10:not(.ssmq-default){display: none;}
@media not screen, (max-width: 768px){.ssmq-10.ssmq-notscreenmax-width768px{display:block}.ssmq-10:not(.ssmq-notscreenmax-width768px){display: none;}}</style><div class="ssmq-10 ssmq-notscreenmax-width768px"><section class="ch-scrollycoding-static"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mock-integrations">Mock Integrations<a class="hash-link" href="#mock-integrations" title="Direct link to heading">​</a></h2><p>This example uses the <a href="https://github.com/moq/moq4" target="_blank" rel="noopener noreferrer">Moq</a> library to create mock implementations of our SDK calls. This Lambda function is setup to list all buckets in S3, yeah it&#x27;s trivial I know. What it does show us is how easily we can test how our Lambda function deals with different responses from S3.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="UnitTest.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>UnitTest.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>[Fact]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public async Task TestLambdaHandlerWithValidS3Response_ShouldReturnSuccess()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockedS3Client = new Mock&lt;IAmazonS3&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockHttpClient = new Mock&lt;HttpClient&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    mockedS3Client.Setup(p =&gt; p.ListBucketsAsync(It.IsAny&lt;CancellationToken&gt;())).ReturnsAsync(new ListBucketsResponse()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Buckets = new List&lt;S3Bucket&gt;()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket1&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket2&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket3&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        HttpStatusCode = HttpStatusCode.OK</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    });</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var storageService = new S3StorageService(mockedS3Client.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var handler = new ListStorageAreasQueryHandler(storageService, _mockHandlerLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var function = new Function(handler, _mockLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var result = await function.Handler(new APIGatewayProxyRequest(), new TestLambdaContext());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    result.StatusCode.Should().Be(200);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var responseBody = JsonSerializer.Deserialize&lt;ListStorageAreaResponseBody&gt;(result.Body);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody.Should().NotBeNull();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.Count().Should().Be(3);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.FirstOrDefault().Should().Be(&quot;bucket1&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-internal-constructor">Use The Internal Constructor<a class="hash-link" href="#use-the-internal-constructor" title="Direct link to heading">​</a></h2><p>When initializing our <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">Function</span></code></span> under test the internal constructor is used. This allows the mocks that have just been created to be passed into the Function. Our function code is none the wiser, it runs it&#x27;s logic as normal.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="UnitTest.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>UnitTest.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>[Fact]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public async Task TestLambdaHandlerWithValidS3Response_ShouldReturnSuccess()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockedS3Client = new Mock&lt;IAmazonS3&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockHttpClient = new Mock&lt;HttpClient&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    mockedS3Client.Setup(p =&gt; p.ListBucketsAsync(It.IsAny&lt;CancellationToken&gt;())).ReturnsAsync(new ListBucketsResponse()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Buckets = new List&lt;S3Bucket&gt;()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket1&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket2&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket3&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        HttpStatusCode = HttpStatusCode.OK</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    });</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var storageService = new S3StorageService(mockedS3Client.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var handler = new ListStorageAreasQueryHandler(storageService, _mockHandlerLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var function = new Function(handler, _mockLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var result = await function.Handler(new APIGatewayProxyRequest(), new TestLambdaContext());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    result.StatusCode.Should().Be(200);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var responseBody = JsonSerializer.Deserialize&lt;ListStorageAreaResponseBody&gt;(result.Body);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody.Should().NotBeNull();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.Count().Should().Be(3);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.FirstOrDefault().Should().Be(&quot;bucket1&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="assert">Assert<a class="hash-link" href="#assert" title="Direct link to heading">​</a></h2><p>Now that we know what the response from S3 is going to be, we can assert on what the expected response is from our Lambda function. This Lambda function responds to API calls so our assertions are based around the API response that Lambda returns.</p><p>At this point we could test status code, response contents and even the schema of the response.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="UnitTest.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>UnitTest.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>[Fact]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public async Task TestLambdaHandlerWithValidS3Response_ShouldReturnSuccess()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockedS3Client = new Mock&lt;IAmazonS3&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockHttpClient = new Mock&lt;HttpClient&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    mockedS3Client.Setup(p =&gt; p.ListBucketsAsync(It.IsAny&lt;CancellationToken&gt;())).ReturnsAsync(new ListBucketsResponse()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Buckets = new List&lt;S3Bucket&gt;()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket1&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket2&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket3&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        HttpStatusCode = HttpStatusCode.OK</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    });</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var storageService = new S3StorageService(mockedS3Client.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var handler = new ListStorageAreasQueryHandler(storageService, _mockHandlerLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var function = new Function(handler, _mockLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var result = await function.Handler(new APIGatewayProxyRequest(), new TestLambdaContext());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    result.StatusCode.Should().Be(200);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var responseBody = JsonSerializer.Deserialize&lt;ListStorageAreaResponseBody&gt;(result.Body);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody.Should().NotBeNull();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.Count().Should().Be(3);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.FirstOrDefault().Should().Be(&quot;bucket1&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-problems">Testing Problems<a class="hash-link" href="#testing-problems" title="Direct link to heading">​</a></h2><p>We can use this same framework to test for errors. In this example our S3 client is mocked to return <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">null</span></code></span> buckets and a <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">BadRequest</span></code></span> status code. The business case defines that the API call itself always returns a 200 status code. If there are errors in S3 then the API returns an empty array for the bucket list.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="UnitTest.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>UnitTest.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>[Fact]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public async Task TestLambdaHandlerWithS3NullResponse_ShouldReturnEmpty()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockedS3Client = new Mock&lt;IAmazonS3&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockHttpClient = new Mock&lt;HttpClient&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    mockedS3Client.Setup(p =&gt; p.ListBucketsAsync(It.IsAny&lt;CancellationToken&gt;())).ReturnsAsync(new ListBucketsResponse()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Buckets = null,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        HttpStatusCode = HttpStatusCode.BadRequest</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    });</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var storageService = new S3StorageService(mockedS3Client.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var handler = new ListStorageAreasQueryHandler(storageService, _mockHandlerLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var function = new Function(handler, _mockLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var result = await function.Handler(new APIGatewayProxyRequest(), new TestLambdaContext());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    result.StatusCode.Should().Be(200);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var responseBody = JsonSerializer.Deserialize&lt;ListStorageAreaResponseBody&gt;(result.Body);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody.Should().NotBeNull();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.Count().Should().Be(0);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="asserting-on-problems">Asserting On Problems<a class="hash-link" href="#asserting-on-problems" title="Direct link to heading">​</a></h2><p>That can be seen in the assertions. Mock implementations are passed into the Function in the same way and we are testing that a 200 status and empty array is received.</p><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="UnitTest.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>UnitTest.cs</div></div><div style="flex:1;min-width:0.8em"></div></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span>[Fact]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public async Task TestLambdaHandlerWithS3NullResponse_ShouldReturnEmpty()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockedS3Client = new Mock&lt;IAmazonS3&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockHttpClient = new Mock&lt;HttpClient&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    mockedS3Client.Setup(p =&gt; p.ListBucketsAsync(It.IsAny&lt;CancellationToken&gt;())).ReturnsAsync(new ListBucketsResponse()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Buckets = null,</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        HttpStatusCode = HttpStatusCode.BadRequest</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    });</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var storageService = new S3StorageService(mockedS3Client.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var handler = new ListStorageAreasQueryHandler(storageService, _mockHandlerLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var function = new Function(handler, _mockLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var result = await function.Handler(new APIGatewayProxyRequest(), new TestLambdaContext());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    result.StatusCode.Should().Be(200);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var responseBody = JsonSerializer.Deserialize&lt;ListStorageAreaResponseBody&gt;(result.Body);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody.Should().NotBeNull();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.Count().Should().Be(0);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div></section></div><div class="ssmq-10 ssmq-default"><section class="ch-scrollycoding"><div class="ch-scrollycoding-content"><div class="ch-scrollycoding-step-content" data-selected="true"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mock-integrations">Mock Integrations<a class="hash-link" href="#mock-integrations" title="Direct link to heading">​</a></h2><p>This example uses the <a href="https://github.com/moq/moq4" target="_blank" rel="noopener noreferrer">Moq</a> library to create mock implementations of our SDK calls. This Lambda function is setup to list all buckets in S3, yeah it&#x27;s trivial I know. What it does show us is how easily we can test how our Lambda function deals with different responses from S3.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-internal-constructor">Use The Internal Constructor<a class="hash-link" href="#use-the-internal-constructor" title="Direct link to heading">​</a></h2><p>When initializing our <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9FF">Function</span></code></span> under test the internal constructor is used. This allows the mocks that have just been created to be passed into the Function. Our function code is none the wiser, it runs it&#x27;s logic as normal.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="assert">Assert<a class="hash-link" href="#assert" title="Direct link to heading">​</a></h2><p>Now that we know what the response from S3 is going to be, we can assert on what the expected response is from our Lambda function. This Lambda function responds to API calls so our assertions are based around the API response that Lambda returns.</p><p>At this point we could test status code, response contents and even the schema of the response.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-problems">Testing Problems<a class="hash-link" href="#testing-problems" title="Direct link to heading">​</a></h2><p>We can use this same framework to test for errors. In this example our S3 client is mocked to return <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#81A1C1">null</span></code></span> buckets and a <span class="ch-inline-code not-prose"><code style="--ch-code-foreground:#d8dee9ff;background:#2e3440e6;color:#d8dee9ff"><span style="color:#D8DEE9">BadRequest</span></code></span> status code. The business case defines that the API call itself always returns a 200 status code. If there are errors in S3 then the API returns an empty array for the bucket list.</p></div><div class="ch-scrollycoding-step-content"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="asserting-on-problems">Asserting On Problems<a class="hash-link" href="#asserting-on-problems" title="Direct link to heading">​</a></h2><p>That can be seen in the assertions. Mock implementations are passed into the Function in the same way and we are testing that a 200 status and empty array is received.</p></div></div><div class="ch-scrollycoding-sticker"><div class="ch-codegroup not-prose"><div class="ch-editor-frame" style="background:#2e3440"><div class="ch-frame-title-bar" style="color:#C5C5C5;background:#2e3440"><div class="ch-frame-buttons"><div class="ch-frame-button ch-frame-button-left"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-middle"></div><div class="ch-frame-button-space"></div><div class="ch-frame-button ch-frame-button-right"></div></div><div title="UnitTest.cs" data-ch-tab="north" class="ch-editor-tab ch-editor-tab-active" style="background:#3b4252;color:#d8dee9;border-right-color:#3b425200;border-bottom-color:#88c0d000"><div><span style="opacity:0.5"></span>UnitTest.cs</div></div><div style="flex:1;min-width:0.8em"></div><svg class="ch-editor-button" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="button"><title>Expand</title><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg><dialog class="ch-expand-dialog"><svg class="ch-expand-close" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" role="button"><title>Close</title><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></dialog></div><div data-ch-panel="north" style="flex-grow:1;overflow:hidden"><div class="ch-code-wrapper" style="margin:0;padding:0;position:relative;white-space:pre;box-sizing:content-box;opacity:0;overflow:auto;height:100%"><code class="ch-code-scroll-parent"><br><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>[Fact]</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>public async Task TestLambdaHandlerWithValidS3Response_ShouldReturnSuccess()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>{</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockedS3Client = new Mock&lt;IAmazonS3&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var mockHttpClient = new Mock&lt;HttpClient&gt;();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    mockedS3Client.Setup(p =&gt; p.ListBucketsAsync(It.IsAny&lt;CancellationToken&gt;())).ReturnsAsync(new ListBucketsResponse()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        Buckets = new List&lt;S3Bucket&gt;()</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        {</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket1&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket2&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>            new S3Bucket(){BucketName = &quot;bucket3&quot;},</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        },</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>        HttpStatusCode = HttpStatusCode.OK</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    });</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    </span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var storageService = new S3StorageService(mockedS3Client.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var handler = new ListStorageAreasQueryHandler(storageService, _mockHandlerLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var function = new Function(handler, _mockLogger.Object);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var result = await function.Handler(new APIGatewayProxyRequest(), new TestLambdaContext());</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    result.StatusCode.Should().Be(200);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    var responseBody = JsonSerializer.Deserialize&lt;ListStorageAreaResponseBody&gt;(result.Body);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span></span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody.Should().NotBeNull();</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.Count().Should().Be(3);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>    responseBody?.StorageAreas.FirstOrDefault().Should().Be(&quot;bucket1&quot;);</span></div></div><div><div style="display:inline-block;margin-left:16px"><span>}</span></div></div><br></code></div></div></div></div></div></section></div><script class="ssmq-10">!function(){for(var e=["not screen, (max-width: 768px)","default"],t=["ssmq-notscreenmax-width768px","ssmq-default"],s=document.getElementsByTagName("script"),o=s[s.length-1].parentNode,r=null,c=0;c<e.length-1;c++)if(window.matchMedia(e[c]).matches){r=o.querySelector(":scope > .ssmq-10."+t[c]);break}if(!r){var a=t.pop();r=o.querySelector(":scope > .ssmq-10."+a)}r.removeAttribute("class"),o.querySelectorAll(":scope > .ssmq-10").forEach((function(e){o.removeChild(e)}))}()</script>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="debugging">Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">​</a></h2>
<p>Remember, when running unit tests in either Visual Studio, VS Code or JetBrains Rider you can attach a debugger to your test run. As .NET developers expecting that &#x27;localhost&#x27; development experience this is a powerful alternative. Use the test framework as the harness for our debugger.</p>
<p>The second benefit of this, we now have a full suite of unit tests that can be re-used by other developers and CICD pipelines. It removes &#x27;intuition based&#x27; debugging on local host and makes it something repeatable.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a class="hash-link" href="#further-reading" title="Direct link to heading">​</a></h2>
<ul>
<li>The AWS Samples GitHub organisation contains a <a href="https://github.com/aws-samples/serverless-test-samples" target="_blank" rel="noopener noreferrer">serverless-test-samples repository</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/testing/unit-testing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/testing/test-ready-lambda-functions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Test Ready Lambda Functions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/testing/integration-testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Integration Test In The Cloud</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mock-integrations" class="table-of-contents__link toc-highlight">Mock Integrations</a></li><li><a href="#use-the-internal-constructor" class="table-of-contents__link toc-highlight">Use The Internal Constructor</a></li><li><a href="#assert" class="table-of-contents__link toc-highlight">Assert</a></li><li><a href="#testing-problems" class="table-of-contents__link toc-highlight">Testing Problems</a></li><li><a href="#asserting-on-problems" class="table-of-contents__link toc-highlight">Asserting On Problems</a></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li><li><a href="#further-reading" class="table-of-contents__link toc-highlight">Further Reading</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Built by @plantpowerjames</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/plantpowerjames" target="_blank" rel="noopener noreferrer" class="footer__link-item">@plantpowerjames</a></li><li class="footer__item"><a href="https://github.com/jeastham1993/serverless-dotnet.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report Issues on GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Serverless .NET. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.983b73cc.js"></script>
<script src="/assets/js/main.761a135f.js"></script>
</body>
</html>